# 编译功能

## 需求

- 自动检测 UE 项目文件
- 自动获取引擎安装路径
- 调用 UE 编译工具编译项目
- 实时显示编译日志
- 编译成功后打开项目

## 设计方案

### 项目检测

读取当前目录下的 `.uproject` 文件（JSON 格式）：

```json
{
  "FileVersion": 3,
  "EngineAssociation": "5.3",
  "Category": "",
  "Description": ""
}
```

- `EngineAssociation`: 引擎版本号

### 引擎路径获取

优先级顺序：

1. **Windows 注册表**
   - `HKEY_LOCAL_MACHINE\SOFTWARE\EpicGames\Unreal Engine\{版本}`
   - `HKEY_CURRENT_USER\SOFTWARE\EpicGames\Unreal Engine\{版本}`
   - 键值: `InstalledDirectory`

2. **Epic Games Launcher 配置**
   - `%PROGRAMDATA%\Epic\UnrealEngineLauncher\LauncherInstalled.dat`
   - `%LOCALAPPDATA%\EpicGamesLauncher\Saved\Config\Windows\LauncherInstalled.dat`

3. **默认路径**
   - `C:/Program Files/Epic Games/UE_{版本}`

### 编译命令

```bash
Engine/Build/BatchFiles/Build.bat {项目名}Editor Win64 Development -Project="{项目路径}" -WaitMutex -FromMsBuild
```

### 打开项目

```bash
Engine/Binaries/Win64/UnrealEditor.exe "{项目路径}"
```

兼容 UE4: `UE4Editor.exe`

## 任务清单

- [x] 数据层：项目信息读取
- [x] 数据层：引擎路径获取（注册表）
- [x] 数据层：引擎路径获取（Launcher 配置）
- [x] 逻辑层：编译管理器
- [x] 逻辑层：打开项目
- [x] UI 层：主窗口
- [x] UI 层：日志显示
- [x] UI 层：进度指示

## 讨论记录

### 2025-01-16

- 确定使用 Python + tkinter 实现 GUI
- 三层架构：UI / Logic / Data
- 优先支持 Windows，后续考虑跨平台

## 边界问题与解决方案

| 问题 | 解决方案 |
|------|----------|
| 引擎路径找不到 | 按优先级尝试多种方式获取 |
| UE4/UE5 编辑器名不同 | 先检测 UnrealEditor.exe，不存在则用 UE4Editor.exe |
| 编译输出乱码 | subprocess 使用 `encoding='utf-8', errors='replace'` |

## 废弃方案

| 方案 | 废弃原因 |
|------|----------|
| 纯批处理脚本 | 无法显示 GUI，跨平台困难 |
